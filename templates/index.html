<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宫颈细胞学AI辅助诊断系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 1200px;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .upload-area {
            border: 2px dashed #6c757d;
            border-radius: 8px;
            padding: 3rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #f8f9fa;
        }
        .upload-area:hover {
            border-color: #667eea;
            background-color: #f1f3f5;
        }
        .upload-area.active {
            border-color: #667eea;
            background-color: rgba(102, 126, 234, 0.1);
        }
        .preview-image {
            max-width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .result-card {
            margin-top: 2rem;
        }
        .status-badge {
            font-size: 0.9rem;
            padding: 0.5rem 1rem;
        }
        .confidence-bar {
            height: 10px;
            border-radius: 5px;
            background-color: #e9ecef;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease-out;
        }
        .loading-spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 4px solid #667eea;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.5s;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        .cell-type-normal { color: #28a745; }
        .cell-type-ascus { color: #ffc107; }
        .cell-type-lsil { color: #fd7e14; }
        .cell-type-hsil { color: #dc3545; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1 class="text-center">宫颈细胞学AI辅助诊断系统</h1>
            <p class="text-center mt-2">基于ModelArts的智能细胞学分析平台</p>
        </div>
    </div>

    <div class="container" id="app">
        <!-- 主要功能区域 -->
        <div class="row">
            <!-- 左侧上传区域 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">上传宫颈液基细胞学图像</h2>
                        
                        <!-- 文件上传区域 -->
                        <div 
                            class="upload-area mt-4" 
                            :class="{ active: isDragging }"
                            @dragover.prevent="isDragging = true"
                            @dragleave.prevent="isDragging = false"
                            @drop.prevent="handleDrop"
                            @click="triggerFileInput"
                        >
                            <input 
                                type="file" 
                                ref="fileInput"
                                style="display: none"
                                accept=".png, .jpg, .jpeg, .tiff"
                                @change="handleFileSelect"
                            >
                            
                            <div v-if="!selectedImage">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#6c757d" class="bi bi-cloud-upload" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
                                    <path fill-rule="evenodd" d="M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708l3-3z"/>
                                </svg>
                                <p class="mt-3">点击或拖拽图像到此处上传</p>
                                <p class="text-muted text-sm mt-1">支持 PNG, JPG, JPEG, TIFF 格式</p>
                            </div>
                            
                            <div v-else class="text-center">
                                <img :src="selectedImage" class="preview-image" alt="预览图像">
                                <p class="mt-2 text-sm text-muted">{{ fileName }}</p>
                                <button class="btn btn-danger btn-sm mt-2" @click="clearImage">
                                    清除图像
                                </button>
                            </div>
                        </div>
                        
                        <!-- 诊断按钮 -->
                        <div class="mt-4 text-center">
                            <button 
                                class="btn btn-primary btn-lg" 
                                :disabled="!selectedImage || isProcessing"
                                @click="diagnose"
                            >
                                <span v-if="isProcessing" class="loading-spinner me-2"></span>
                                {{ isProcessing ? '诊断中...' : '开始AI诊断' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 右侧结果显示区域 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">诊断结果</h2>
                        
                        <!-- 初始提示 -->
                        <div v-if="!diagnosticResult && !errorMessage" class="text-center py-5 text-muted">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="#adb5bd" class="bi bi-search" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            </svg>
                            <p class="mt-3">上传图像后点击诊断按钮获取结果</p>
                        </div>
                        
                        <!-- 加载状态 -->
                        <div v-else-if="isProcessing" class="text-center py-5">
                            <div class="loading-spinner"></div>
                            <p class="mt-3">AI正在分析图像，请稍候...</p>
                            <p class="text-sm text-muted">根据图像复杂度，可能需要10-30秒</p>
                        </div>
                        
                        <!-- 错误信息 -->
                        <div v-else-if="errorMessage" class="alert alert-danger mt-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                            </svg>
                            {{ errorMessage }}
                        </div>
                        
                        <!-- 诊断结果 -->
                        <div v-else-if="diagnosticResult" class="result-card">
                            <div class="mb-3">
                                <span class="badge status-badge" :class="getResultClass(diagnosticResult.cell_type)">
                                    {{ diagnosticResult.cell_type }}
                                </span>
                            </div>
                            
                            <div class="mb-3">
                                <div class="d-flex justify-content-between mb-1">
                                    <span>置信度：</span>
                                    <span class="font-weight-bold">{{ Math.round(diagnosticResult.confidence * 100) }}%</span>
                                </div>
                                <div class="confidence-bar">
                                    <div 
                                        class="confidence-fill" 
                                        :style="{ 
                                            width: Math.round(diagnosticResult.confidence * 100) + '%',
                                            backgroundColor: getConfidenceColor(diagnosticResult.confidence)
                                        }"
                                    ></div>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h4>诊断建议</h4>
                                <p class="mt-2 p-3 bg-light rounded">{{ diagnosticResult.suggestion }}</p>
                            </div>
                            
                            <div class="mt-4 text-center">
                                <p class="text-muted text-sm">
                                    <small>免责声明：本系统仅提供辅助诊断建议，最终诊断结果请以临床医生判断为准。</small>
                                </p>
                                <button class="btn btn-outline-primary mt-2" @click="resetDiagnosis">
                                    重新开始
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 系统介绍区域 -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">系统介绍</h2>
                        <div class="mt-3">
                            <p>本系统基于华为ModelArts平台构建，采用深度学习技术对宫颈液基细胞学（LBC）图像进行自动分析，能够检测非典型鳞状细胞（ASC-US）、低级别鳞状上皮内病变（LSIL）和高级别鳞状上皮内病变（HSIL）等。</p>
                            
                            <div class="row mt-4">
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded">
                                        <h5>技术特点</h5>
                                        <ul class="mt-2 list-unstyled">
                                            <li>? 基于ResNet-50/EfficientNet深度学习模型</li>
                                            <li>? 在Ascend 910处理器上训练优化</li>
                                            <li>? 支持多种图像格式和分辨率</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded">
                                        <h5>诊断指标</h5>
                                        <ul class="mt-2 list-unstyled">
                                            <li>? 灵敏度：98.96%</li>
                                            <li>? 特异度：89.15%</li>
                                            <li>? AUC值：≥0.95</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="p-3 bg-light rounded">
                                        <h5>适用人群</h5>
                                        <ul class="mt-2 list-unstyled">
                                            <li>? 宫颈癌筛查人群</li>
                                            <li>? 需要细胞学复查的患者</li>
                                            <li>? 基层医疗机构辅助诊断</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="mt-5 py-4 bg-dark text-white text-center">
        <div class="container">
            <p>&copy; 2025 宫颈细胞学AI辅助诊断系统 - 基于华为ModelArts平台开发</p>
        </div>
    </footer>

    <script>
        const { createApp } = Vue
        
        createApp({
            data() {
                return {
                    isDragging: false,
                    selectedImage: null,
                    fileName: '',
                    isProcessing: false,
                    diagnosticResult: null,
                    errorMessage: null
                }
            },
            methods: {
                triggerFileInput() {
                    if (!this.isProcessing) {
                        this.$refs.fileInput.click()
                    }
                },
                
                handleFileSelect(event) {
                    const file = event.target.files[0]
                    if (file) {
                        this.processFile(file)
                    }
                },
                
                handleDrop(event) {
                    this.isDragging = false
                    const file = event.dataTransfer.files[0]
                    if (file) {
                        this.processFile(file)
                    }
                },
                
                processFile(file) {
                    // 检查文件类型
                    const validTypes = ['image/png', 'image/jpeg', 'image/tiff']
                    if (!validTypes.includes(file.type)) {
                        this.errorMessage = '请上传PNG、JPG或TIFF格式的图像文件'
                        return
                    }
                    
                    // 清除之前的错误
                    this.errorMessage = null
                    this.diagnosticResult = null
                    
                    // 显示文件名
                    this.fileName = file.name
                    
                    // 创建预览URL
                    const reader = new FileReader()
                    reader.onload = (e) => {
                        this.selectedImage = e.target.result
                    }
                    reader.readAsDataURL(file)
                    
                    // 重置文件输入，允许重新选择相同文件
                    this.$refs.fileInput.value = ''
                },
                
                clearImage() {
                    this.selectedImage = null
                    this.fileName = ''
                    this.diagnosticResult = null
                    this.errorMessage = null
                },
                
                diagnose() {
                    if (!this.selectedImage || this.isProcessing) {
                        return
                    }
                    
                    this.isProcessing = true
                    this.errorMessage = null
                    this.diagnosticResult = null
                    
                    // 获取图像文件
                    fetch(this.selectedImage)
                        .then(res => res.blob())
                        .then(blob => {
                            const formData = new FormData()
                            formData.append('file', blob, this.fileName)
                            
                            // 调用后端API
                            return fetch('/api/diagnose', {
                                method: 'POST',
                                body: formData
                            })
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('服务器错误')
                            }
                            return response.json()
                        })
                        .then(data => {
                            this.isProcessing = false
                            
                            if (data.status === 'success') {
                                this.diagnosticResult = data
                            } else {
                                this.errorMessage = data.message || '诊断过程中出现错误'
                            }
                        })
                        .catch(error => {
                            this.isProcessing = false
                            this.errorMessage = '诊断过程中出现网络错误，请稍后重试'
                            console.error('诊断错误:', error)
                        })
                },
                
                resetDiagnosis() {
                    this.clearImage()
                },
                
                getResultClass(cellType) {
                    const classMap = {
                        '正常': 'bg-success',
                        'ASC-US': 'bg-warning',
                        'LSIL': 'bg-orange',
                        'HSIL': 'bg-danger'
                    }
                    return classMap[cellType] || 'bg-info'
                },
                
                getConfidenceColor(confidence) {
                    if (confidence >= 0.9) return '#28a745'  // 绿色
                    if (confidence >= 0.7) return '#ffc107'  // 黄色
                    if (confidence >= 0.5) return '#fd7e14'  // 橙色
                    return '#dc3545'  // 红色
                }
            }
        }).mount('#app')
    </script>
</body>
</html>